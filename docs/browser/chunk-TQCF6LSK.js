import{a as he,b as Ce,c as ve}from"./chunk-3PYUEOGT.js";import{a as q,b as me,c as E}from"./chunk-TWMUISPN.js";import"./chunk-UEXQXD4E.js";import{a as U}from"./chunk-3NBKQ2M3.js";import{a as ge}from"./chunk-TGNFV3NF.js";import{$a as st,$d as kt,$e as Qt,Ac as _t,Ae as Lt,Ba as O,Ca as z,Cc as bt,Cd as $,Ce as jt,Da as c,Dc as wt,Dd as yt,Ea as n,Ec as xt,Ef as pe,Fa as a,Fc as St,Fd as S,Ga as p,Gd as y,Ge as Bt,He as Vt,Id as At,Jd as H,Je as A,Jf as I,K as nt,Ka as mt,L as D,La as ct,Lb as pt,Ld as Pt,Le as $t,Lf as ue,N as ot,Na as tt,Nd as Et,O as lt,P as Q,Pa as _,Pb as ut,Pf as fe,Q as W,Qe as Ht,Ra as h,Re as Gt,Vd as It,Ve as qt,W as N,Wb as ft,Wd as Tt,We as Ut,Xe as Jt,Ye as Kt,Ze as Xt,_e as Zt,ab as l,ae as Dt,af as Wt,bb as L,bc as j,bf as Yt,cb as u,da as R,db as dt,de as Nt,df as te,ea as o,ec as B,ef as ee,fc as V,gf as ie,hc as P,he as Rt,hf as re,ia as d,ie as Ft,je as Ot,jf as ae,kf as ne,la as b,lc as gt,ma as F,mf as oe,nc as f,nf as le,q as at,qa as Y,qb as et,qc as ht,r as k,rc as Ct,rf as ce,sb as it,uc as g,uf as se,wa as w,wc as vt,xe as zt,ya as x,ye as G,yf as de,zc as Mt}from"./chunk-KVV3I3RP.js";var C=(()=>{let t=class t{constructor(i){this.http=i,this.eventsPaginator=new ue("/api/articles/list")}getArticle(i){return this.http.get(`/api/articles/${i}`).pipe(k(E))}list(i=I){return this.eventsPaginator.loadPage(i,E)}createArticle(i){return this.http.post("/api/articles",i).pipe(k(E))}updateArticle(i){return this.http.put("/api/articles",i).pipe(k(E))}deleteArticle(i){return this.http.delete(`/api/articles/${i}`)}};t.\u0275fac=function(m){return new(m||t)(ot(ft))},t.\u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();var J=(r,t)=>r.paramMap.get("slug")==="new"?at(null):lt(C).getArticle(r.paramMap.get("slug"));var ye=(r,t)=>t.id;function Ae(r,t){if(r&1&&(n(0,"mat-chip-row",5),p(1,"img",6),l(2),a(),p(3,"mat-divider",7)),r&2){let e=h();c("routerLink","/organizations/"+e.article().organization_slug),o(),c("src",e.article().organization_logo,R),o(),u(" ",e.article().organization_name," "),o(),c("vertical",!0)}}function Pe(r,t){if(r&1&&p(0,"img",6),r&2){let e=h().$implicit;c("src",e.github_avatar,R)}}function Ee(r,t){if(r&1&&(n(0,"mat-chip-row",3),w(1,Pe,1,1,"img",6),l(2),a()),r&2){let e=t.$implicit;c("routerLink","/profile/"+e.onyen),o(),x(e.github_avatar&&e.github_avatar!==""?1:-1),o(),dt(" ",e.first_name," ",e.last_name," ")}}var we=(()=>{let t=class t{constructor(i,m,s){this.route=i,this.newsService=m,this.gearService=s;let Z=this.route.snapshot.data;this.article=N(Z.article)}ngOnInit(){this.gearService.showAdminGearByPermissionCheck("article.*","*","",`/article/${this.article().slug}/edit`)}};t.Route={path:":slug",title:" ",component:t,resolve:{article:J}},t.\u0275fac=function(m){return new(m||t)(d(j),d(C),d(pe))},t.\u0275cmp=b({type:t,selectors:[["app-article-page"]],standalone:!1,decls:22,vars:12,consts:[[1,"container"],[1,"card-container"],["matCardImage","",1,"feature-image",3,"src"],[3,"routerLink"],["markdown","",1,"description"],["id","organization-chip",3,"routerLink"],["matChipAvatar","",1,"profile-icon",3,"src"],[1,"vertical-divider",3,"vertical"]],template:function(m,s){m&1&&(n(0,"div",0)(1,"div",1)(2,"mat-pane"),p(3,"img",2),a(),n(4,"mat-pane")(5,"mat-card-header")(6,"mat-card-title"),l(7),a()(),n(8,"mat-card-content")(9,"p"),l(10),et(11,"date"),n(12,"em"),l(13),et(14,"date"),a()(),n(15,"mat-chip-set"),w(16,Ae,4,4),O(17,Ee,3,4,"mat-chip-row",3,ye),a(),p(19,"mat-divider"),n(20,"p",4),l(21),a()()()()()),m&2&&(o(3),c("src",s.article().image_url,R),o(4),L(s.article().title),o(3),u(" ",it(11,6,s.article().published,"mediumDate")," - "),o(3),u("Modified ",it(14,9,s.article().last_modified&&s.article().last_modified,"mediumDate")),o(3),x(s.article().organization_slug?16:-1),o(),z(s.article().authors),o(4),u(" ",s.article().body," "))},dependencies:[y,H,Pt,S,$t,Ht,Gt,Ot,V,A,ce,pt],styles:[".container[_ngcontent-%COMP%]{width:100%}.card-container[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;width:738px}.feature-image[_ngcontent-%COMP%]{max-height:200px!important;object-fit:cover}.mat-divider[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px}.profile-icon[_ngcontent-%COMP%]{border-radius:50%}@media only screen and (max-width: 976px){.card-container[_ngcontent-%COMP%]{margin:none;max-width:100%}}"]});let r=t;return r})();function ke(r,t){r&1&&(n(0,"th",8)(1,"div",9)(2,"mat-card-title"),l(3,"Articles"),a(),n(4,"button",10),l(5," Create "),a()()())}function De(r,t){r&1&&(n(0,"span",13),l(1," Announcement "),a())}function Ne(r,t){if(r&1){let e=tt();n(0,"td",11)(1,"div",12)(2,"p"),l(3),n(4,"span"),l(5),a(),w(6,De,2,0,"span",13),a(),n(7,"div",14)(8,"button",15),_("click",function(){let m=Q(e).$implicit,s=h(2);return W(s.deleteArticle(m))}),l(9," Delete "),a(),n(10,"button",16),l(11," Edit "),a(),n(12,"button",17),l(13," View "),a()()()()}if(r&2){let e=t.$implicit,i=h(2);o(3),u(" ",e.title," "),o(),st("text-badge "+(e.state===i.articleState.DRAFT?"secondary-container-background":e.state===i.articleState.PUBLISHED?"primary-fixed-dim-background":"tertiary-container-background")),o(),u(" ",e.state," "),o(),x(e.is_announcement?6:-1),o(4),c("routerLink","/article/"+e.slug+"/edit"),o(2),c("routerLink","/article/"+e.slug)}}function Re(r,t){r&1&&p(0,"tr",18)}function Fe(r,t){r&1&&p(0,"tr",19)}function Oe(r,t){if(r&1){let e=tt();n(0,"mat-pane")(1,"mat-card-content")(2,"div",0)(3,"table",1),mt(4,2),Y(5,ke,6,0,"th",3)(6,Ne,14,7,"td",4),ct(),Y(7,Re,1,0,"tr",5)(8,Fe,1,0,"tr",6),a(),n(9,"mat-paginator",7),_("page",function(m){Q(e);let s=h();return W(s.handlePageEvent(m))}),a()()()()}if(r&2){let e=h();o(3),c("dataSource",e.articlesPage().items),o(4),c("matHeaderRowDef",e.displayedColumns),o(),c("matRowDefColumns",e.displayedColumns),o(),c("length",e.articlesPage().length)("pageSize",e.articlesPage().params.page_size)("pageIndex",e.articlesPage().params.page)}}var v=class v{constructor(t,e,i){this.router=t,this.snackBar=e,this.newsService=i,this.articlesPage=N(void 0),this.displayedColumns=["title"],this.articleState=q,this.newsService.list(I).subscribe(m=>{this.articlesPage.set(m)})}deleteArticle(t){this.snackBar.open("Are you sure you want to delete this article?","Delete",{duration:15e3}).onAction().subscribe(()=>{this.newsService.deleteArticle(t.id).subscribe(()=>{this.newsService.list(I).subscribe(i=>{this.articlesPage.set(i)}),this.snackBar.open("This article has been deleted.","",{duration:2e3})})})}handlePageEvent(t){let e=this.articlesPage().params;e.page=t.pageIndex,e.page_size=t.pageSize,this.newsService.list(e).subscribe(i=>this.articlesPage.set(i))}};v.Route={path:"admin",component:v,title:"News Administration",canActivate:[U("article.*","*")]},v.\u0275fac=function(e){return new(e||v)(d(B),d(G),d(C))},v.\u0275cmp=b({type:v,selectors:[["app-news-admin"]],standalone:!1,decls:1,vars:1,consts:[[1,"table-responsive"],["mat-table","",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageIndex"],["mat-header-cell",""],[1,"header"],["mat-stroked-button","","routerLink","/article/new/edit"],["mat-cell",""],[1,"row"],["id","announcement",1,"text-badge","primary-container-background"],[1,"button-container"],["mat-stroked-button","",1,"tertiary-button","control-buttons",3,"click"],["mat-stroked-button","",1,"control-buttons",3,"routerLink"],["mat-flat-button","",1,"control-buttons",3,"routerLink"],["mat-header-row",""],["mat-row",""]],template:function(e,i){e&1&&w(0,Oe,10,6,"mat-pane"),e&2&&x(i.articlesPage()?0:-1)},dependencies:[Qt,Yt,re,te,Wt,ae,ee,ie,ne,oe,y,S,$,Xt,V,A],styles:[".mat-mdc-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{border-bottom:1px solid transparent;border-top:1px solid transparent;cursor:pointer}.mat-mdc-row[_ngcontent-%COMP%]:hover   .mat-mdc-cell[_ngcontent-%COMP%]{border-color:#fff}.header[_ngcontent-%COMP%], .row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{justify-content:space-between;margin:5px}  .mat-mdc-card-outlined{max-width:100%!important;margin-right:32px!important}.text-badge[_ngcontent-%COMP%]{font-size:10px;height:22px;width:32px;text-align:center;padding:2px 6px;border-radius:11px;line-height:22px;color:#fff}#announcement[_ngcontent-%COMP%]{margin-left:4px}"]});var K=v;var ze=(r,t)=>t.id;function Le(r,t){if(r&1&&(n(0,"mat-option",2),l(1),a()),r&2){let e=t.$implicit;c("value",e.id),o(),L(e.name)}}var M=class M{constructor(t,e,i,m,s,Z){this.route=t,this.router=e,this.snackBar=i,this.newsService=m,this.organizationService=s,this.formBuilder=Z,this.articleState=q,this.articleForm=this.formBuilder.group({title:new g("",[f.required]),state:new g("",[f.required]),slug:new g("",[f.required,f.pattern("^(?!new$)[a-z0-9-]+$")]),image_url:new g("",[f.required]),synopsis:new g("",[f.required,f.maxLength(400)]),body:new g("",[f.required]),organization_id:new g(null),is_announcement:new g(!1,[f.required])}),this.authors=[];let Se=this.route.snapshot.data;this.article=Se.article,this.article?(this.articleForm.patchValue(this.article),this.authors=this.article.authors):this.articleForm.patchValue({title:"",slug:"",image_url:"",synopsis:"",body:"",organization_id:null,is_announcement:!1})}onSubmit(){if(this.articleForm.valid){let t=this.article?this.article:me;Object.assign(t,this.articleForm.value),t.authors=this.authors,this.isNew()?t.published=new Date:t.last_modified=new Date,(this.isNew()?this.newsService.createArticle(t):this.newsService.updateArticle(t)).subscribe({next:i=>this.onSuccess(i),error:i=>this.onError(i)})}}onSuccess(t){this.router.navigate(["/article/admin"]),this.snackBar.open(`Article ${this.action()}`,"",{duration:2e3})}onError(t){this.snackBar.open(`Error: Article Not ${this.action()}`,"",{duration:2e3})}onReset(){this.articleForm.patchValue(this.article)}isNew(){return this.article===null}generateSlug(){let t=this.articleForm.controls.title.value,e=this.articleForm.controls.slug.value;if(t&&!e){var i=t.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-");this.articleForm.setControl("slug",new g(i))}}action(){return this.isNew()?"Created":"Updated"}};M.Route={path:":slug/edit",component:M,title:"Organization Editor",canActivate:[U("article.*","*")],resolve:{article:J}},M.\u0275fac=function(e){return new(e||M)(d(j),d(B),d(G),d(C),d(ge),d(wt))},M.\u0275cmp=b({type:M,selectors:[["app-article-editor"]],standalone:!1,decls:47,vars:7,consts:[[3,"ngSubmit","formGroup"],["formControlName","state","name","state",1,"state-buttons"],[3,"value"],["appearance","outline","color","accent"],["matInput","","placeholder","","formControlName","title","name","title","required","",3,"change"],["hintLabel","Lowercase letters, numbers, or dashes","matInput","","placeholder","","formControlName","slug","name","slug","required",""],["appearance","outline"],["formControlName","organization_id"],["label","Authors",3,"users"],["matInput","","placeholder","","formControlName","image_url","name","image_url"],["hintLabel","Max 400 characters","appearance","outline","color","accent"],["matInput","","placeholder","The synopsis appears on the home page of the CSXL.","formControlName","synopsis","name","synopsis"],["appearance","outline","color","accent","id","body-form-field"],["matInput","","placeholder","Enter the body text of your article here. Markdown elements are supported.","formControlName","body","name","body"],["formControlName","is_announcement"],["mat-stroked-button","","color","secondary","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"]],template:function(e,i){e&1&&(n(0,"form",0),_("ngSubmit",function(){return i.onSubmit()}),n(1,"mat-pane")(2,"mat-card-header")(3,"mat-card-title"),l(4),a(),n(5,"mat-button-toggle-group",1)(6,"mat-button-toggle",2),l(7," Draft "),a(),n(8,"mat-button-toggle",2),l(9," Published "),a(),n(10,"mat-button-toggle",2),l(11," Archived "),a()()(),n(12,"mat-card-content")(13,"mat-form-field",3)(14,"mat-label"),l(15,"Article Title"),a(),n(16,"input",4),_("change",function(){return i.generateSlug()}),a()(),n(17,"mat-form-field",3)(18,"mat-label"),l(19,"Slug"),a(),p(20,"input",5),a(),n(21,"mat-form-field",6)(22,"mat-label"),l(23,"Organization"),a(),n(24,"mat-select",7),O(25,Le,2,2,"mat-option",2,ze),a()(),p(27,"user-lookup",8),n(28,"mat-form-field",3)(29,"mat-label"),l(30,"Feature Image URL"),a(),p(31,"input",9),a(),n(32,"mat-form-field",10)(33,"mat-label"),l(34,"Synopsis (Markdown Supported)"),a(),p(35,"textarea",11),a(),n(36,"mat-form-field",12)(37,"mat-label"),l(38,"Article Body (Markdown Supported)"),a(),p(39,"textarea",13),a(),n(40,"mat-slide-toggle",14),l(41," This article is an announcement. "),a()(),n(42,"mat-card-actions")(43,"button",15),_("click",function(){return i.onReset()}),l(44," Reset "),a(),n(45,"button",16),l(46," Save "),a()()()()),e&2&&(c("formGroup",i.articleForm),o(4),u("",i.isNew()?"New":"Edit"," Article"),o(2),c("value",i.articleState.DRAFT),o(2),c("value",i.articleState.PUBLISHED),o(2),c("value",i.articleState.ARCHIVED),o(15),z(i.organizationService.organizations()),o(2),c("users",i.authors),o(18),c("disabled",i.articleForm.invalid))},dependencies:[At,y,H,S,$,kt,Tt,Jt,Ut,Rt,vt,gt,ht,Ct,bt,Mt,_t,de,A,Bt,he,Ce],styles:[".mat-mdc-card-outlined{max-width:100%!important;margin-right:32px!important}mat-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-card-actions[_ngcontent-%COMP%]{padding-bottom:16px;justify-content:end;gap:12px}mat-card-content[_ngcontent-%COMP%]{padding-top:16px}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row}#body-form-field[_ngcontent-%COMP%]{margin-top:16px}mat-card-header[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding-bottom:8px}.state-buttons[_ngcontent-%COMP%]{margin-left:auto}"]});var X=M;var je=[K.Route,we.Route,X.Route],xe=(()=>{let t=class t{};t.\u0275fac=function(m){return new(m||t)},t.\u0275mod=F({type:t}),t.\u0275inj=D({imports:[P.forChild(je),P]});let r=t;return r})();var rr=(()=>{let t=class t{};t.\u0275fac=function(m){return new(m||t)},t.\u0275mod=F({type:t}),t.\u0275inj=D({imports:[ut,Lt,le,Et,qt,It,yt,Kt,Dt,Ft,Zt,zt,se,xt,St,Nt,jt,P,fe,xe,Vt,ve]});let r=t;return r})();export{rr as NewsModule};
